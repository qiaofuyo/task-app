# 项目概览：智能任务管理 App

---

## 一、核心需求

1. **录音与转写**  
   - 点击按钮启动录音  
   - 本地离线语音识别（Vosk Android SDK）实时转文字  
   - 自动根据转写结果生成任务项  

2. **四象限任务管理**  
   - 任务按「重要 × 紧急」四象限分类，默认落在「不重要 但紧急」  
   - 支持通过拖拽在象限间调整任务  

3. **本地存储**  
   - Android 端所有数据本地持久化（SQLite）  
   - 未来可选接入 Drift 以增强类型安全与响应式  

4. **智能提醒**  
   - 基于 Android WorkManager 的周期性/延时通知  
   - 如需秒级精准提醒，可结合 AlarmManager  

5. **多端预留**  
   - 现阶段仅 Android；后续扩展至 iOS、Web、桌面端  
   - 本地存储可升级为云端同步  

---

## 二、技术栈

| 模块           | 选型                                                            |
| -------------- | --------------------------------------------------------------- |
| UI 框架        | Flutter                                                         |
| UI 组件库      | Flutter Material                                               |
| 路由导航       | go_router                                                      |
| 状态管理       | Riverpod                                                       |
| 依赖注入       | get_it（必要时可配合 injectable + build_runner 自动生成注册） |
| 本地存储       | SQLite（未来可选 Drift）                                        |
| 语音识别       | Vosk Android SDK                                               |
| 原生交互       | MethodChannel                                                  |
| 任务提醒       | WorkManager（结合 AlarmManager）                                |

---

## 三、分层架构

| 层级                         | 职责                                                         | 核心示例                                                      |
|------------------------------|--------------------------------------------------------------|---------------------------------------------------------------|
| **Presentation（UI）**       | 界面展示、用户交互、路由与状态绑定                           | Flutter 页面 + go_router + Riverpod                           |
| **Application／Use-Case**    | 编排业务流程（用例）                                         | `TranscribeAndCreateTaskUseCase`                              |
| **Domain（领域）**           | 核心实体、值对象、领域服务接口                               | `Task`、`Quadrant`、`ITranscriptionEngine`                    |
| **Data（数据）**             | Repository 实现、DTO ↔ Entity 映射、本地/远程数据源抽象      | `LocalTaskRepository` (SQLite)、未来 `CloudTaskRepository`    |
| **Infrastructure（平台）**   | 平台能力封装：录音、识别、提醒调度、文件访问                 | MethodChannel + Vosk SDK + WorkManager／AlarmManager          |
| **Cross-Cutting（横切）**    | 日志、异常捕获、依赖注入容器、环境配置                       | get_it + injectable、Logger、Flavor 管理                      |

---

> **要点：**  
> - **层与层之间单向依赖**，保证高内聚低耦合；  
> - **Domain 层无任何平台依赖**，业务逻辑可多端复用；  
> - **Infrastructure 层替换即可支持新平台**，上层无需改动；  
> - **Data 层替换即可接入云同步**，无需触及业务与 UI。







## -------------------------------------







## 一、项目需求拆解

1. **录音与转写**
   - 需要集成本地离线语音识别（Vosk Android SDK），并在录音时将声音实时转换为文字。
   - 转写文字要触发任务创建逻辑。
2. **四象限任务管理**
   - UI 层展示经典「重要×紧急」四象限，支持拖拽在各象限间移动。
   - 默认将新任务放在「不重要但紧急」象限。
3. **本地存储**
   - 所有数据用 SQLite 本地持久化（后续可切换到 Drift 或 云端）。
4. **智能提醒**
   - 利用 WorkManager（配合 AlarmManager）实现周期性／延时通知。
5. **分层架构**
   - Presentation → Application/Use-Case → Domain → Data → Infrastructure → Cross-Cutting
   - 层间单向依赖，Domain 无平台依赖，Infrastructure 可替换支持多端。
6. **技术选型**
   - Flutter + go_router + Riverpod + get_it/injectable + SQLite + Vosk SDK + WorkManager/AlarmManager

------

## 二、开发环境与 VS Code 配置

1. **安装必要工具**

   ```
   bash复制代码# 安装 Flutter SDK（已装则跳过）
   git clone https://github.com/flutter/flutter.git -b stable $HOME/flutter
   export PATH="$HOME/flutter/bin:$PATH"
   
   # 验证环境
   flutter doctor
   ```

2. **VS Code 扩展**

   - **Flutter**
   - **Dart**
   - **Android iOS Emulator**（可选）
   - **SQLite**（可视化调试数据库）
   - **Riverpod Snippets**（提升开发效率）

3. **Android SDK & 模拟器**

   - 确保 Android SDK、Platform‐Tools、Android Emulator 已安装
   - 在 VS Code 底部状态栏选择目标模拟器或真机

------

## 三、项目初始化

1. **创建 Flutter 项目**

   ```
   bash复制代码cd path/to/your/workspace
   flutter create smart_task_app
   cd smart_task_app
   code .    # 在 VS Code 中打开
   ```

2. **调整目录结构**

   ```
   text复制代码lib/
   ├── main.dart
   ├── presentation/       # UI 层
   │   ├── pages/
   │   └── widgets/
   ├── application/        # 用例层
   │   └── usecases/
   ├── domain/             # 领域层
   │   ├── entities/
   │   ├── value_objects/
   │   └── services/
   ├── data/               # 数据层
   │   ├── repositories/
   │   └── models/
   ├── infrastructure/     # 平台能力封装
   │   ├── recording/
   │   ├── transcription/
   │   └── notifications/
   └── core/               # 横切关注
       ├── di/             # 依赖注入配置
       └── utils/
   ```

3. **配置 `pubspec.yaml`**
    在 `dependencies` 下加入：

   ```
   yaml复制代码flutter:
     sdk: flutter
   go_router: ^7.0.0
   flutter_riverpod: ^2.0.0
   get_it: ^8.0.0
   injectable: ^2.0.0
   sqlite3_flutter_libs: any
   sqflite: ^2.0.0
   workmanager: ^0.5.0
   vosk_flutter: ^0.1.0    # 示例名，请根据最新包名调整
   ```

   然后执行：

   ```
   bash
   
   
   复制代码
   flutter pub get
   ```

------

## 四、依赖注入与架构骨架

1. **get_it + injectable 配置**

   - 在 `core/di/` 下创建 `injection.dart`，初始化 `GetIt.instance` 并载入生成的注入文件。

   - 标注各服务／仓库／用例层类为 `@injectable`，运行：

     ```
     bash
     
     
     复制代码
     flutter pub run build_runner build --delete-conflicting-outputs
     ```

2. **搭建 Domain 层**

   - 定义 `Task` 实体、`Quadrant` 值对象，以及 `ITranscriptionEngine`、`ITaskRepository` 接口。

3. **实现 Use-Case**

   - 在 `application/usecases` 下新增 `transcribe_and_create_task_usecase.dart`，注入 `ITranscriptionEngine`、`ITaskRepository`，实现转写+任务创建逻辑。

------

## 五、录音与本地转写（Vosk）

1. **Native SDK 集成**
   - 在 `android/` 目录下配置 Vosk AAR 或 Gradle 依赖。
   - 通过 `MethodChannel` 在 Flutter 侧暴露 `startRecording()`、`stopRecording()`、`onTranscription(String)` 回调。
2. **Flutter 侧封装**
   - 在 `infrastructure/transcription/vosk_transcription_engine.dart` 实现 `ITranscriptionEngine`。
   - 通过 `EventChannel` 或回调流将文字流传递给 Use-Case。

------

## 六、数据持久化（SQLite）

1. **建表与 Repository**
   - 在 `data/models/task_model.dart` 定义 `TaskModel` 与 `TaskEntity` 的映射。
   - 在 `data/repositories/local_task_repository.dart` 使用 `sqflite` 实现 `ITaskRepository`。
2. **测试 CRUD**
   - 在项目初期编写简单单元测试，验证插入、查询、更新、删除功能正常。

------

## 七、UI 与四象限拖拽

1. **页面搭建**
   - 入口 `main.dart` 中配置 `GoRouter`，注册首页路由。
   - 在 `presentation/pages/quadrant_page.dart` 绘制 2×2 网格，使用 `GestureDetector` 或 `flutter_drag_and_drop_gridview` 实现拖拽。
2. **状态管理**
   - 使用 Riverpod 提供 `tasksProvider`（异步 Notifier），监听数据库变更并重建 UI。

------

## 八、智能提醒（WorkManager）

1. **注册后台任务**
   - 在 Android 原生 `Application` 中初始化 `WorkManager`，注册 Flutter 回调。
   - 在 Flutter 侧调用 `Workmanager.registerPeriodicTask(...)` 或 `registerOneOffTask(...)`，设置提醒策略。
2. **接收通知**
   - 在 `infrastructure/notifications/` 下封装 AlarmManager 或 Notification 插件，弹出系统通知。

------

## 九、迭代与多端预留

- 当前专注 Android 实现。
- 代码按分层架构编写，无平台依赖，后续可在 iOS/Web/Desktop 侧替换 Infrastructure。
- 数据层切换到云端时，仅需实现新的 `CloudTaskRepository` 并替换 DI 绑定。

------

## 十、日常开发流程建议

1. **版本控制**

   ```
   bash复制代码git init
   git add .
   git commit -m "chore: init project skeleton"
   ```

2. **分支策略**

   - `main`：稳定可发布代码
   - `feature/xxx`：每个新需求一个分支

3. **持续测试**

   - 单元测试覆盖 Domain／Use-Case／Repository
   - 集成测试模拟录音转写、数据库操作
